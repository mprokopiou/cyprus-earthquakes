<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Cyprus Earthquake Map | Real-Time Seismic Activity</title>
  <meta name="description" content="Live interactive map showing recent earthquakes around Cyprus with real-time magnitude, time, and location updates from EMSC.">
  <meta name="keywords" content="Cyprus earthquakes, earthquake map, live earthquakes, seismic activity, EMSC, real-time earthquakes">
  <meta name="robots" content="index, follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Structured Data for Google -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Dataset",
    "name": "Cyprus Earthquake Data",
    "description": "Live map showing recent earthquakes near Cyprus, including magnitude and time.",
    "license": "https://creativecommons.org/licenses/by/4.0/",
    "creator": {
      "@type": "Organization",
      "name": "European-Mediterranean Seismological Centre (EMSC)"
    },
    "distribution": [{
      "@type": "DataDownload",
      "encodingFormat": "application/json",
      "contentUrl": "https://www.seismicportal.eu/fdsnws/event/1/query"
    }]
  }
  </script>

  <style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f9f9f9;
  }
  #map {
    height: calc(100vh - 200px);
    transition: height 0.3s ease;
  }
  .content {
    padding: 15px 20px;
    max-width: 900px;
    margin: 0 auto;
    line-height: 1.6;
    position: relative;
  }
  .hidden-panel {
    display: none;
  }
  .full-map {
    height: 100vh !important;
  }
</style>

</head>
<body>

  <div id="info-panel" class="content">
  <button id="toggle-info"
    style="float:right; margin-top:-5px; background:#2a3d66; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer;">
    Hide Info
  </button>

  <h1>Live Cyprus Earthquake Map</h1>
  <p>
    This map displays recent earthquakes around <strong>Cyprus</strong> based on live data from the
    <a href="https://www.seismicportal.eu/" target="_blank">EMSC</a>.
  </p>
  <p>
    Each marker is color-coded by age: green (<24h), orange (1â€“3 days), red (>3 days).
  </p>
</div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map("map").setView([35.0, 33.2], 8);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 18 }).addTo(map);

    const url = "https://www.seismicportal.eu/fdsnws/event/1/query?format=json&starttime=2025-11-12T00:00:00&minlat=34.4&maxlat=36.0&minlon=32.0&maxlon=35.0";

    fetch(url)
      .then(res => res.json())
      .then(data => {
        if (!data.features) return alert("No earthquake data found!");
        const earthquakes = data.features.map(f => ({
          place: f.properties.flynn_region,
          mag: f.properties.mag,
          time: new Date(f.properties.time),
          lat: f.geometry.coordinates[1],
          lon: f.geometry.coordinates[0],
        }));
        earthquakes.sort((a, b) => b.time - a.time);
        const now = new Date();

        earthquakes.forEach((eq, i) => {
          const hoursOld = (now - eq.time) / 3600000;
          let color = "green";
          if (hoursOld > 24) color = "orange";
          if (hoursOld > 72) color = "red";
          const marker = L.circleMarker([eq.lat, eq.lon], {
            radius: Math.max(eq.mag, 3),
            color,
            fillColor: color,
            fillOpacity: 0.6
          }).addTo(map);

          const cyTime = eq.time.toLocaleString("en-GB", {
            timeZone: "Europe/Athens",
            dateStyle: "medium",
            timeStyle: "short",
          });
          marker.bindPopup(`<b>${eq.place}</b><br>Magnitude: ${eq.mag}<br>Time (Cyprus): ${cyTime}`);
          if (i === 0) marker.openPopup();
        });
      })
      .catch(err => console.error(err));

    // Persistent legend
    const legend = document.createElement("div");
    legend.innerHTML = `
      <div style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(255,255,255,0.9);
        border-radius: 8px;
        padding: 10px 14px;
        font-size: 13px;
        line-height: 1.5;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        z-index: 1000;">
        <b>Legend:</b><br>
        ðŸŸ¢ Recent (&lt;24h)<br>
        ðŸŸ  1â€“3 days<br>
        ðŸ”´ &gt;3 days
      </div>`;
    document.body.appendChild(legend);

    const toggleBtn = document.getElementById("toggle-info");
    const infoPanel = document.getElementById("info-panel");
    const mapDiv = document.getElementById("map");

    toggleBtn.addEventListener("click", () => {
    infoPanel.classList.toggle("hidden-panel");
    mapDiv.classList.toggle("full-map");

    toggleBtn.textContent = infoPanel.classList.contains("hidden-panel")
      ? "Show Info"
      : "Hide Info";

    setTimeout(() => {
      map.invalidateSize(); // Fix Leaflet resize issues
    }, 300);
  });
  </script>
</body>
</html>
